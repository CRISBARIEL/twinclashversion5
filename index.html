<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/twinlogo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Twin Clash ‚ö° - Memory Card Game</title>
    <meta
      name="description"
      content="Twin Clash - Epic memory card matching game. Challenge yourself, compete in duels, and collect themes!"
    />

    <!-- Google AdSense (WEB) - ONLY THIS PUB -->
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2179904258127705"
      crossorigin="anonymous"
    ></script>

    <!-- GameMonetize SDK -->
    <script src="https://api.gamemonetize.com/sdk.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-messaging-compat.js"></script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>

    <script>
      // -----------------------------
      // GameMonetize init (required)
      // -----------------------------
      window.sdk = null;
      window.sdk_init = false;

      function initGameMonetize() {
        const GM = window.GameMonetize || window.GM;
        if (!GM || typeof GM.init !== "function") {
          console.warn("[GameMonetize] SDK not ready yet");
          return;
        }

        try {
          GM.init({
            gameId: "u6759vgzobxnr0oqgv1njvil5phnplwl",
            onReady: function (sdk) {
              window.sdk = sdk;
              window.sdk_init = true;
              console.log("[GameMonetize] SDK READY ‚úÖ");
            },
            onError: function (e) {
              console.error("[GameMonetize] INIT ERROR:", e);
            },
          });
        } catch (e) {
          console.error("[GameMonetize] INIT EXCEPTION:", e);
        }
      }

      window.addEventListener("load", () => {
        // small delay to ensure sdk.js is available
        setTimeout(initGameMonetize, 200);
      });

      // -----------------------------
      // Rewarded ads (GameMonetize)
      // No reward unless ad is completed
      // -----------------------------
      window.showRewardedAd = function () {
        const showMessage = (text, bgColor = "#333") => {
          const msg = document.createElement("div");
          msg.textContent = text;
          msg.style.cssText =
            "position:fixed;bottom:20px;left:50%;transform:translateX(-50%);" +
            "background:" +
            bgColor +
            ";color:#fff;padding:12px 24px;border-radius:8px;z-index:9999;" +
            "font-size:14px;font-weight:bold;box-shadow:0 4px 12px rgba(0,0,0,0.3);";
          document.body.appendChild(msg);
          setTimeout(() => msg.remove(), 3000);
        };

        const grantReward = () => {
          window.dispatchEvent(new CustomEvent("add-coins", { detail: 2000 }));
          showMessage("¬°Has ganado +2.000 monedas! üéâ", "#10b981");
        };

        // Prefer the initialized SDK instance if available
        if (window.sdk_init === true && window.sdk && typeof window.sdk.showRewardedAd === "function") {
          console.log("[GameMonetize] Using sdk.showRewardedAd()");
          try {
            window.sdk.showRewardedAd({
              onRewardGranted: () => grantReward(),
              onRewardDeclined: () => showMessage("Completa el anuncio para obtener la recompensa", "#ff9800"),
              onHidden: () => console.log("[GameMonetize] Rewarded hidden"),
              onError: (e) => {
                console.warn("[GameMonetize] Rewarded error/no fill:", e);
                showMessage("No hay anuncio disponible, int√©ntalo m√°s tarde", "#ff4444");
              },
            });
            return;
          } catch (e) {
            console.error("[GameMonetize] SDK rewarded exception:", e);
            showMessage("No hay anuncio disponible, int√©ntalo m√°s tarde", "#ff4444");
            return;
          }
        }

        // Fallback to legacy API if present (some implementations expose this)
        if (window.GameMonetize?.game?.fn?.rewarded) {
          console.log("[GameMonetize] Using GameMonetize.game.fn.rewarded()");
          try {
            window.GameMonetize.game.fn.rewarded(() => grantReward());
            return;
          } catch (e) {
            console.error("[GameMonetize] Legacy rewarded exception:", e);
            showMessage("No hay anuncio disponible, int√©ntalo m√°s tarde", "#ff4444");
            return;
          }
        }

        // No SDK => no reward
        console.warn("[GameMonetize] SDK not available");
        showMessage("No hay anuncio disponible, int√©ntalo m√°s tarde", "#ff4444");
      };
    </script>
    <script>
  // Bot√≥n de TEST para GameMonetize (solo aparece en iframe/verificador)
  window.addEventListener("load", () => {
    const inIframe = window.top !== window.self;
    const isGM = location.hostname.includes("gamemonetize");

    if (!(inIframe || isGM)) return; // en tu web normal NO aparece

    const btn = document.createElement("button");
    btn.textContent = "Ver anuncio (+2000)";
    btn.style.cssText = `
      position:fixed;
      bottom:12px;
      right:12px;
      z-index:999999;
      padding:12px 16px;
      border:none;
      border-radius:10px;
      background:#10b981;
      color:white;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(0,0,0,.25);
    `;

    btn.onclick = () => {
      if (typeof window.showRewardedAd === "function") {
        window.showRewardedAd();
      } else {
        alert("showRewardedAd no est√° listo a√∫n");
      }
    };

    document.body.appendChild(btn);
  });
</script>
  </body>
</html>

